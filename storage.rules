rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // Public read-only assets (no write access)
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if false;
    }

    // Skincare product images: user-specific access
    match /skincare/products/{userId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Skincare routine/journal images
    match /skincare/{userId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Wellness journal uploads
    match /wellness/{userId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    match /groups/{groupId}/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Profile pictures
    match /profile_pictures/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Support ticket images
    match /support_tickets/{userId}/{ticketId}/{fileName} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // User progress photos and other private data
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Default deny for all other paths
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
